name: Notify Discord on Release

on:
  release:
    types: [published]
  workflow_dispatch: {}

permissions:
  contents: read

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Discord webhook
        if: ${{ secrets.DISCORD_WEBHOOK_URL != '' }}
        run: |
          payload=$(jq -n --arg name "${{ github.event.release.name }}" \
                        --arg tag "${{ github.event.release.tag_name }}" \
                        --arg url "${{ github.event.release.html_url }}" \
                        '{"content": ("**Release published**: " + $name + " (" + $tag + ")\n" + $url)}')
          curl -s -H "Content-Type: application/json" -X POST -d "$payload" "$DISCORD_WEBHOOK_URL"
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
      - name: Fallback note
        if: ${{ secrets.DISCORD_WEBHOOK_URL == '' }}
        run: echo "No DISCORD_WEBHOOK_URL secret found; skipping Discord notification."